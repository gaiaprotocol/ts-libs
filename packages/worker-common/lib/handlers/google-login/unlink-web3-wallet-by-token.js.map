{"version":3,"file":"unlink-web3-wallet-by-token.js","sourceRoot":"","sources":["../../../src/handlers/google-login/unlink-web3-wallet-by-token.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,UAAU,EAAE,MAAM,MAAM,CAAC;AAClC,OAAO,EAAE,qBAAqB,EAAE,MAAM,qBAAqB,CAAC;AAC5D,OAAO,EAAE,WAAW,EAAE,MAAM,oBAAoB,CAAC;AAEjD,MAAM,CAAC,KAAK,UAAU,mCAAmC,CACvD,OAAgB,EAChB,GAA2C,EAC3C,MAAe;IAEf,IAAI,CAAC;QACH,MAAM,IAAI,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QAClD,IAAI,CAAC,IAAI,EAAE,UAAU,CAAC,SAAS,CAAC,EAAE,CAAC;YACjC,OAAO,IAAI,QAAQ,CAAC,cAAc,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC;QACpH,CAAC;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAC5B,MAAM,OAAO,GAAG,MAAM,WAAW,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;QAC9C,IAAI,CAAC,OAAO,EAAE,GAAG,EAAE,CAAC;YAClB,OAAO,IAAI,QAAQ,CAAC,cAAc,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC;QACpH,CAAC;QAED,MAAM,iBAAiB,GAAG,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAElD,MAAM,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,OAAO,CACjC;gCAC0B,CAC3B;aACE,IAAI,CAAC,iBAAiB,CAAC;aACvB,GAAG,EAAE,CAAC;QAET,OAAO,QAAQ,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC;IACtJ,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACnB,OAAO,QAAQ,CAAC,IAAI,CAClB,EAAE,KAAK,EAAE,GAAG,YAAY,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,EAC3D,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,CAC7E,CAAC;IACJ,CAAC;AACH,CAAC","sourcesContent":["import { D1Database } from '@cloudflare/workers-types';\nimport { getAddress } from 'viem';\nimport { corsHeadersWithOrigin } from '../../services/cors';\nimport { verifyToken } from '../../services/jwt';\n\nexport async function handleUnlinkGoogleWeb3WalletByToken(\n  request: Request,\n  env: { DB: D1Database, JWT_SECRET: string },\n  origin?: string\n): Promise<Response> {\n  try {\n    const auth = request.headers.get('authorization');\n    if (!auth?.startsWith('Bearer ')) {\n      return new Response('Unauthorized', { status: 401, headers: origin ? corsHeadersWithOrigin(origin) : undefined });\n    }\n\n    const token = auth.slice(7);\n    const payload = await verifyToken(token, env);\n    if (!payload?.sub) {\n      return new Response('Unauthorized', { status: 401, headers: origin ? corsHeadersWithOrigin(origin) : undefined });\n    }\n\n    const normalizedAddress = getAddress(payload.sub);\n\n    const result = await env.DB.prepare(\n      `DELETE FROM google_web3_accounts\n       WHERE wallet_address = ?`\n    )\n      .bind(normalizedAddress)\n      .run();\n\n    return Response.json({ ok: true, deleted: result.meta.changes ?? 0 }, { status: 200, headers: origin ? corsHeadersWithOrigin(origin) : undefined });\n  } catch (err) {\n    console.error(err);\n    return Response.json(\n      { error: err instanceof Error ? err.message : String(err) },\n      { status: 500, headers: origin ? corsHeadersWithOrigin(origin) : undefined },\n    );\n  }\n}\n"]}