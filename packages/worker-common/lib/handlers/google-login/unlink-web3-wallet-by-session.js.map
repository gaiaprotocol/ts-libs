{"version":3,"file":"unlink-web3-wallet-by-session.js","sourceRoot":"","sources":["../../../src/handlers/google-login/unlink-web3-wallet-by-session.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,qBAAqB,EAAE,MAAM,qBAAqB,CAAA;AAC3D,OAAO,EAAE,WAAW,EAAE,MAAM,SAAS,CAAA;AAErC,MAAM,CAAC,KAAK,UAAU,qCAAqC,CACzD,OAAgB,EAChB,GAA8C,EAC9C,MAAe;IAEf,IAAI,CAAC;QACH,MAAM,EAAE,GAAG,MAAM,WAAW,CAAC,GAAG,EAAE,OAAO,CAAC,CAAA;QAC1C,IAAI,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC;YACb,OAAO,QAAQ,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,eAAe,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC,CAAA;QAChI,CAAC;QAED,2BAA2B;QAC3B,MAAM,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,OAAO,CAAC;;;KAGnC,CAAC;aACC,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC;aACZ,GAAG,EAAE,CAAA;QAER,oBAAoB;QACpB,OAAO,QAAQ,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC,CAAA;IACrJ,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;QAClB,OAAO,QAAQ,CAAC,IAAI,CAClB,EAAE,KAAK,EAAE,GAAG,YAAY,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,EAC3D,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,CAC7E,CAAA;IACH,CAAC;AACH,CAAC","sourcesContent":["import { D1Database } from '@cloudflare/workers-types'\nimport { corsHeadersWithOrigin } from '../../services/cors'\nimport { readSession } from './utils'\n\nexport async function handleUnlinkGoogleWeb3WalletBySession(\n  request: Request,\n  env: { DB: D1Database, COOKIE_SECRET: string },\n  origin?: string\n): Promise<Response> {\n  try {\n    const me = await readSession(env, request)\n    if (!me?.sub) {\n      return Response.json({ error: 'not_logged_in' }, { status: 401, headers: origin ? corsHeadersWithOrigin(origin) : undefined })\n    }\n\n    // DB에서 해당 사용자의 지갑 연동 정보 삭제\n    const result = await env.DB.prepare(`\n      DELETE FROM google_web3_accounts\n      WHERE google_sub = ?\n    `)\n      .bind(me.sub)\n      .run()\n\n    // 삭제된 row 수 반환 (선택)\n    return Response.json({ ok: true, deleted: result.meta.changes ?? 0 }, { status: 200, headers: origin ? corsHeadersWithOrigin(origin) : undefined })\n  } catch (err) {\n    console.error(err)\n    return Response.json(\n      { error: err instanceof Error ? err.message : String(err) },\n      { status: 500, headers: origin ? corsHeadersWithOrigin(origin) : undefined }\n    )\n  }\n}\n"]}