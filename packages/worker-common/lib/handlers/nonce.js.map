{"version":3,"file":"nonce.js","sourceRoot":"","sources":["../../src/handlers/nonce.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,cAAc,EAAE,MAAM,QAAQ,CAAC;AACxC,OAAO,EAAE,UAAU,EAAE,MAAM,MAAM,CAAC;AAClC,OAAO,EAAE,CAAC,EAAE,MAAM,KAAK,CAAC;AACxB,OAAO,EAAE,YAAY,EAAE,MAAM,kBAAkB,CAAC;AAEhD,yBAAyB;AACzB,MAAM,QAAQ,GAAG,gEAAgE,CAAC;AAElF,cAAc;AACd,MAAM,aAAa,GAAG,cAAc,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;AAEnD,MAAM,CAAC,KAAK,UAAU,WAAW,CAAC,OAAgB,EAAE,GAAiC;IACnF,MAAM,MAAM,GAAG,CAAC,CAAC,MAAM,CAAC;QACtB,OAAO,EAAE,CAAC,CAAC,MAAM,EAAE;QACnB,MAAM,EAAE,CAAC,CAAC,MAAM,EAAE;QAClB,GAAG,EAAE,CAAC,CAAC,MAAM,EAAE;KAChB,CAAC,CAAC;IAEH,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,CAAC,KAAK,CAAC,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC;IAEvD,MAAM,iBAAiB,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;IAC9C,MAAM,KAAK,GAAG,aAAa,EAAE,CAAC;IAC9B,MAAM,QAAQ,GAAG,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC;IAE1C,MAAM,GAAG,CAAC,WAAW,CAAC,GAAG,CAAC,SAAS,iBAAiB,EAAE,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,EAAE,EAAE,aAAa,EAAE,GAAG,EAAE,CAAC,CAAC;IAErH,OAAO,YAAY,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC;AAC3C,CAAC","sourcesContent":["import { KVNamespace } from '@cloudflare/workers-types';\nimport { customAlphabet } from 'nanoid';\nimport { getAddress } from 'viem';\nimport { z } from 'zod';\nimport { jsonWithCors } from '../services/cors';\n\n// 알파벳: alphanumeric only\nconst alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n// 길이: 최소 8 이상\nconst generateNonce = customAlphabet(alphabet, 16);\n\nexport async function handleNonce(request: Request, env: { SIWE_NONCES: KVNamespace }) {\n  const schema = z.object({\n    address: z.string(),\n    domain: z.string(),\n    uri: z.string(),\n  });\n\n  const { address } = schema.parse(await request.json());\n\n  const normalizedAddress = getAddress(address);\n  const nonce = generateNonce();\n  const issuedAt = new Date().toISOString();\n\n  await env.SIWE_NONCES.put(`nonce:${normalizedAddress}`, JSON.stringify({ nonce, issuedAt }), { expirationTtl: 300 });\n\n  return jsonWithCors({ nonce, issuedAt });\n}\n"]}